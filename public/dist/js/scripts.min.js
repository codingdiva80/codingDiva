function Account(){}Account.prototype.checkLoginStatus=function(o){var t=this.getLoginInfo();t&&this.doLogin(t[0],t[1],o)},Account.prototype.doLogin=function(o,t,e){var n=this;$.post("/api/loginattempt",{email:o,password:t}).done(function(c){JSONP.parse(c).success?(n.setLoginInfo(o,t),e&&e(!0)):e&&e()}).fail(function(o){})},Account.prototype.setLoginInfo=function(o,t){localStorage.setItem("email",o),localStorage.setItem("password",t),localStorage.setItem("loggedin",!0)},Account.prototype.getLoginInfo=function(){return[localStorage.getItem("email"),localStorage.getItem("password")]},Account.prototype.logout=function(){localStorage.removeItem("email"),localStorage.removeItem("password");localStorage.setItem("loggedin",!1),setTimeout(function(){window.location.href="/"},2e3)};

class Modal{constructor(){this.showWait=!1,this.centered=!0,this.oMsg}createCover(){this.removeCover();let e=document.createElement("div");e.id="fullCover",document.body.appendChild(e)}createCoverMessage(e="",t=!1){this.createCover();let i=document.createElement("div");i.id="fullCoverMsg";let s="",d="";this.centered&&(d="text-align:center"),s=this.showWait?`\n                <div style=${d}>\n                    <div>\n                        <span><i>please wait...</i></span>\n                        <span><img src='/assets/images/icons/2.gif' class='img-wait' /></span>\n                    </div>  \n                    <div id='msg-area'>${e}</div>\n                </div>`:`<div id='msg-area'>${e}</div>`,i.innerHTML=s,document.body.appendChild(i),t&&(i.innerHTML+="<div class='close'><a href='#'>Close</a></div>"),this.oMsg=i}updateMessage(e){document.getElementById("msg-area").innerHTML=`<div>${e}</div>`}appendMessage(){document.getElementById("msg-area").innerHTML+=`<div>${msg}</div>`}removeCover(){let e=document.getElementById("fullCover");e&&e.parentNode.removeChild(e);let t=document.getElementById("fullCoverMsg");t&&t.parentNode.removeChild(t)}close(){this.removeCover()}}
class UI{renderMainNav(){let n=User.getUserInfo()?'\n            <nav id="navbar">\n                <ul>\n                    <li><a href="#">Home</a></li>\n                    <li><a href="#">Mentorship</a></li>\n                    <li><a href="#">Job Board</a></li>\n                    <li><a href="#">Resources</a></li>\n                    <li><a href="/member/account">My Account</a></li>\n                    <li><a href="/member/logout">Logout</a></li>\n                </ul>\n            </nav>\n        ':'\n            <nav id="navbar">\n                <ul>\n                    <li><a href="#">Home</a></li>\n                    <li><a href="#">Mentorship</a></li>\n                    <li><a href="#">Job Board</a></li>\n                    <li><a href="#">Resources</a></li>\n                    <li><a href="/member/signup">Signup/Login</a></li>\n                </ul>\n            </nav>\n        ',a=document.getElementById("main-header");a&&(a.innerHTML=n)}}
class User{constructor(){this.username=null,this.email=null,this.loggedin=!1}set(){this.username=localStorage.getItem("username"),this.email=localStorage.getItem("email"),this.loggedin=localStorage.getItem("loggedin")}storeLogin(e){localStorage.setItem("email",e.email),localStorage.setItem("password",e.password),localStorage.setItem("username",e.username),localStorage.setItem("loggedin",!0),e.loggedin=!0}checkLoginStatus(){return!!localStorage.getItem("loggedin")&&(this.set(),!0)}static logout(){localStorage.removeItem("loggedin"),localStorage.removeItem("username"),localStorage.removeItem("email"),setTimeout(()=>{document.location.href="/"},500)}static getUserInfo(){let e=new User;return!!localStorage.getItem("loggedin")&&(e.set(),{username:this.username,email:this.email})}}
class UserForm{constructor(e){this.user=e,this.setFormError(),this.initForms(),this.modal}setFormError(){this.formError={message:"",oFormEntity:null}}initForms(){let e=document.getElementById("signup"),r=document.getElementById("login");e&&(e.onclick=(()=>{this.verifyNewUser()?this.submitNewUser():this.errorHandler()})),r&&(r.onclick=(()=>{this.verifyLogin()?this.submitLogin():this.errorHandler()}))}submitLogin(){this.modal=new Modal,this.modal.showWait=!0,this.modal.createCoverMessage("Checking login");let e={email:document.getElementById("login_email").value,password:document.getElementById("login_password").value};fetch("/member/login",{method:"post",headers:{Accept:"application/json, text/plain, text/html, */*","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(r=>{r.error?(this.modal.close(),this.formError.oFormEntity=document.getElementById("login_email"),this.formError.message="Email/password combination incorrect",this.errorHandler()):(this.modal.updateMessage("Logged in, redirecting you to the homepage"),this.user.storeLogin(e),setTimeout(()=>{document.location.href="/"},1e3))})}submitNewUser(){this.modal=new Modal,this.modal.showWait=!0,this.modal.createCoverMessage("Submitting your information");let e={email:document.getElementById("signup_email").value,username:document.getElementById("signup_username").value,password:document.getElementById("signup_pass").value};fetch("/member/newsignup",{method:"post",headers:{Accept:"application/json, text/plain, text/html, */*","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(r=>{r.error&&"email exists"===r.error?(this.modal.close(),this.formError.oFormEntity=document.getElementById("signup_email"),this.formError.message="This email already exists in our system",this.errorHandler()):(this.modal.updateMessage("User added, logging you in..."),this.user.storeLogin(e),setTimeout(()=>{document.location.href="/"},1e3))})}verifyNewUser(){this.setFormError(),this.unsetErrors();let e=document.getElementById("signup_username"),r=document.getElementById("signup_email"),t=document.getElementById("signup_pass"),o=document.getElementById("signup_pass2");return""===e.value?(this.formError.message="Missing username",this.formError.oFormEntity=e,!1):e.value.length<5?(this.formError.message="Username must be at least 5 characters long",this.formError.oFormEntity=e,!1):""===r.value?(this.formError.message="Missing email",this.formError.oFormEntity=r,!1):r.value.length<5?(this.formError.message="Email must be at least 5 characters long",this.formError.oFormEntity=r,!1):""===t.value?(this.formError.message="Missing password",this.formError.oFormEntity=t,!1):""===o.value?(this.formError.message="Missing password confirm",this.formError.oFormEntity=o,!1):t.value.length<5?(this.formError.message="Password must be at least 5 characters long",this.formError.oFormEntity=t,!1):o.value===t.value||(this.formError.message="Passwords do not match",this.formError.oFormEntity=o,!1)}verifyLogin(){this.setFormError(),this.unsetErrors();let e=document.getElementById("login_email"),r=document.getElementById("login_password");return""===e.value?(this.formError.message="Login is blank",this.formError.oFormEntity=e,!1):e.value.length<5||-1===e.value.indexOf("@")?(this.formError.message="Not a valid email address",this.formError.oFormEntity=e,!1):""===r.value?(this.formError.message="Password cannot be left blank",this.formError.oFormEntity=r,!1):!(r.value.length<5)||(this.formError.message="Password must be at least 5 characters",this.formError.oFormEntity=r,!1)}errorHandler(){let e=this.formError.oFormEntity,r=document.createElement("div");r.style.width="200px",r.style.padding="5px",r.style.textAlign="right",r.style.color="red",e.parentNode.insertBefore(r,e.parentNode.childNodes[0]),r.innerHTML=this.formError.message,r.id="error-msg",e.classList.add("form-error")}unsetErrors(){let e=document.getElementById("error-msg");e&&e.parentNode.removeChild(e);let r=document.querySelector(".form-error");r&&r.classList.remove("form-error")}}