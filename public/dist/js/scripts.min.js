function Account(){}Account.prototype.checkLoginStatus=function(o){var t=this.getLoginInfo();t&&this.doLogin(t[0],t[1],o)},Account.prototype.doLogin=function(o,t,e){var n=this;$.post("/api/loginattempt",{email:o,password:t}).done(function(c){JSONP.parse(c).success?(n.setLoginInfo(o,t),e&&e(!0)):e&&e()}).fail(function(o){})},Account.prototype.setLoginInfo=function(o,t){localStorage.setItem("email",o),localStorage.setItem("password",t),localStorage.setItem("loggedin",!0)},Account.prototype.getLoginInfo=function(){return[localStorage.getItem("email"),localStorage.getItem("password")]},Account.prototype.logout=function(){localStorage.removeItem("email"),localStorage.removeItem("password");localStorage.setItem("loggedin",!1),setTimeout(function(){window.location.href="/"},2e3)};

class Mentorship{constructor(e){this.user=e,this.testing=!0}getPosts(){return{}}renderPosts(e){if(!e)throw"You shouldn't call this method without a div id";let n="";(this.testing?mock_getPosts():this.getPosts()).forEach(e=>{let t="mentor"===e.type?"mentor.png":"requestor.png";n+=`<div class='mentorship-post'>\n                    <p><img src='/assets/images/icons/${t}' class='icon-mentor' /></p>\n                    <p><span>Username:</span><span>${e.username}</span></p>\n                    <p><span>Date:</span><span>${e.date}</span></p>\n                    <p><span>Location:</span><span>${e.location}</span></p>\n                    <p><span>${e.message}</p>\n                   </div>\n            `}),document.getElementById(e).innerHTML=n}showPostForm(e){}}function mock_getPosts(){return[{id:1e3,date:"2018-03-01",username:"Luna",location:"San Francisco",message:"Hello divas, I am an experinced web developer. I mainly work with front-end technologies but have some experince with node and mongo. I am mainly free in the evenings for an hour or so. I would like to help if you have any questions about anything tech related!",type:"mentor"},{id:1001,date:"2018-03-05",username:"Kate",location:"San Francisco",message:"hello friends. I am having the hardest time with React js. I just started learning it and can't wrap my head around props and state. If anybody could walk me through that, that would be great! I am flexible with my schedule. Just let me know when it's convenient for you. Thanks so much!",type:"requestor"},{id:1002,date:"2018-02-18",username:"Jane",location:"San Francisco",message:"Hey guys, I am working on a data scraping project and I am stuck on the mongo database. If anybody could look at my code tonight or tomorrow morning, that would be super helpful! Thanks in advance!",type:"requestor"},{id:1003,date:"2018-01-29",username:"Ann",location:"San Francisco",message:"Hello people if you need any help getting ready for technical interviews, I am here to help.",type:"mentor"},{id:1e3,date:"2018-03-30",username:"Mary",location:"San Leandro",message:"Hello people if you need any help getting ready for technical interviews, I am here to help.",type:"requestor"}]}
class MessagePost{renderPostButton(e){let t=document.createElement("button");t.classList.add("submit"),t.onclick=(()=>{if(User.getUserInfo())this.renderPostMessage();else{let e=new Modal;e.centered=!0,e.createCoverMessage("You must be logged in to post a message");let t="\n                    <span><a href='#' onclick=\"UI.clickSaveLink('/member/signup');\">Login</a></span>\n                    &nbsp;&nbsp;&nbsp;&nbsp;\n                    <span><a href='#' onclick='Modal.close()'>Close</a></span>\n                ";e.appendMessage(t,1e3)}}),t.textContent="Create a new post",document.getElementById(e).appendChild(t)}renderPostMessage(){let e=new Modal;e.wide=!0,e.createCoverMessage("\n            <div class='postmessage'>\n                <div class='postmessage-left'>\n                    <span>Need help?<span>\n                    <p>\n                        <textarea placeholder=\"Ex: Help! I don't understand react, I need a mentor\"></textarea>\n                    </p>\n                </div>\n\n                <div class='postmessage-right'>\n                    <span>Mentor: Offer a message of mentorship</span>\n                    <p>\n                        <textarea placeholder=\"Ex: Hey, divas, if you need some help, I'm available most afternoons\"></textarea>\n                    </p>\n                </div>\n            </div>\n        ");let t=document.createElement("button");t.classList.add("post-question-submit"),t.textContent="Submit question",document.querySelector(".postmessage-left").appendChild(t),t.onclick=(()=>{alert("asking for help")}),(t=document.createElement("button")).classList.add("post-question-submit"),t.textContent="Cancel",document.querySelector(".postmessage-left").appendChild(t),t.onclick=(()=>{Modal.close()}),(t=document.createElement("button")).classList.add("post-help-submit"),t.textContent="Submit help",document.querySelector(".postmessage-right").appendChild(t),t.onclick=(()=>{alert("providing help")}),(t=document.createElement("button")).classList.add("post-question-submit"),t.textContent="Cancel",document.querySelector(".postmessage-right").appendChild(t),t.onclick=(()=>{Modal.close()})}}renderPostButton=(e=>{(new MessagePost).renderPostButton(e)});
class Modal{constructor(){this.showWait=!1,this.centered=!0,this.oMsg,this.wide=!1}createCover(){this.removeCover();let e=document.createElement("div");e.id="fullCover",e.style.height=document.body.scrollHeight+"px",document.body.appendChild(e)}createCoverMessage(e="",t=!1){let i=this.wide?Math.floor(.8*document.body.clientWidth):Math.floor(.5*document.body.clientWidth);this.createCover();let d=document.createElement("div");d.id="fullCoverMsg";let s=Math.floor(document.body.clientWidth/2-i/2);d.style.left=`${s}px`,d.style.width=`${i}px`;let n="",o="";this.centered&&(o="text-align:center;"),n=this.showWait?`\n                <div style='${o}'>\n                    <div>\n                        <span><i>please wait...</i></span>\n                        <span><img src='/assets/images/icons/2.gif' class='img-wait' /></span>\n                    </div>  \n                    <div id='msg-area'>${e}</div>\n                </div>`:`<div id='msg-area' style='${o}'>${e}</div>`,d.innerHTML=n,document.body.appendChild(d),t&&(d.innerHTML+="<div class='close'><a href='#'>Close</a></div>"),this.oMsg=d}updateMessage(e,t=0){let i="";this.centered&&(i="width:100%;text-align:center"),setTimeout(()=>{document.getElementById("msg-area").innerHTML=`<div style='${i}'>${e}</div>`},t)}appendMessage(e,t=0){let i="";this.centered&&(i="width:100%;text-align:center"),setTimeout(()=>{document.getElementById("msg-area").innerHTML+=`<div style='${i}'>${e}</div>`},t)}removeCover(){let e=document.getElementById("fullCover");e&&e.parentNode.removeChild(e);let t=document.getElementById("fullCoverMsg");t&&t.parentNode.removeChild(t)}static close(){(new Modal).removeCover()}}
class UI{renderMainNav(){let e=User.getUserInfo()?'\n            <nav id="navbar">\n                <ul>\n                    <li><a href="/">Home</a></li>\n                    <li><a href="#">Mentorship</a></li>\n                    <li><a href="#">Job Board</a></li>\n                    <li><a href="#">Resources</a></li>\n                    <li><a href="/member/account">My Account</a></li>\n                    <li><a href="/member/logout">Logout</a></li>\n                </ul>\n            </nav>\n        ':'\n            <nav id="navbar">\n                <ul>\n                    <li><a href="/">Home</a></li>\n                    <li><a href="#">Mentorship</a></li>\n                    <li><a href="#">Job Board</a></li>\n                    <li><a href="#">Resources</a></li>\n                    <li><a href="/member/signup">Signup/Login</a></li>\n                </ul>\n            </nav>\n        ',a=document.getElementById("main-header");a&&(a.innerHTML=e)}static clickSaveLink(e){let a=window.location;localStorage.setItem("lastLocation",a.toString()),setTimeout(()=>{document.location.href=e},0)}static getLastLink(){let e=localStorage.getItem("lastLocation");return e&&0!==e?e:"/"}}
class User{constructor(){this.username=null,this.email=null,this.loggedin=!1}set(){this.username=localStorage.getItem("username"),this.email=localStorage.getItem("email"),this.loggedin=localStorage.getItem("loggedin")}storeLogin(e){localStorage.setItem("email",e.email),localStorage.setItem("password",e.password),localStorage.setItem("username",e.username),localStorage.setItem("loggedin",!0),e.loggedin=!0}checkLoginStatus(){return!!localStorage.getItem("loggedin")&&(this.set(),!0)}static logout(){localStorage.removeItem("loggedin"),localStorage.removeItem("username"),localStorage.removeItem("email"),setTimeout(()=>{document.location.href="/"},500)}static getUserInfo(){let e=new User;return!!localStorage.getItem("loggedin")&&(e.set(),{username:this.username,email:this.email})}}
class UserForm{constructor(e){this.user=e,this.setFormError(),this.initForms(),this.modal}setFormError(){this.formError={message:"",oFormEntity:null}}initForms(){let e=document.getElementById("signup"),r=document.getElementById("login");e&&(e.onclick=(()=>{this.verifyNewUser()?this.submitNewUser():this.errorHandler()})),r&&(r.onclick=(()=>{this.verifyLogin()?this.submitLogin():this.errorHandler()}))}submitLogin(){this.modal=new Modal,this.modal.showWait=!0,this.modal.createCoverMessage("Checking login");let e={email:document.getElementById("login_email").value,password:document.getElementById("login_password").value};fetch("/member/login",{method:"post",headers:{Accept:"application/json, text/plain, text/html, */*","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(r=>{r.error?(this.modal.close(),this.formError.oFormEntity=document.getElementById("login_email"),this.formError.message="Email/password combination incorrect",this.errorHandler()):(this.modal.updateMessage("Logged in, redirecting you to the homepage"),this.user.storeLogin(e),setTimeout(()=>{let e=UI.getLastLink();document.location.href=e},1e3))})}submitNewUser(){this.modal=new Modal,this.modal.showWait=!0,this.modal.createCoverMessage("Submitting your information");let e={email:document.getElementById("signup_email").value,username:document.getElementById("signup_username").value,password:document.getElementById("signup_pass").value};fetch("/member/newsignup",{method:"post",headers:{Accept:"application/json, text/plain, text/html, */*","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(r=>{r.error&&"email exists"===r.error?(this.modal.close(),this.formError.oFormEntity=document.getElementById("signup_email"),this.formError.message="This email already exists in our system",this.errorHandler()):(this.modal.updateMessage("User added, logging you in..."),this.user.storeLogin(e),setTimeout(()=>{document.location.href="/"},1e3))})}verifyNewUser(){this.setFormError(),this.unsetErrors();let e=document.getElementById("signup_username"),r=document.getElementById("signup_email"),t=document.getElementById("signup_pass"),o=document.getElementById("signup_pass2");return""===e.value?(this.formError.message="Missing username",this.formError.oFormEntity=e,!1):e.value.length<5?(this.formError.message="Username must be at least 5 characters long",this.formError.oFormEntity=e,!1):""===r.value?(this.formError.message="Missing email",this.formError.oFormEntity=r,!1):r.value.length<5?(this.formError.message="Email must be at least 5 characters long",this.formError.oFormEntity=r,!1):""===t.value?(this.formError.message="Missing password",this.formError.oFormEntity=t,!1):""===o.value?(this.formError.message="Missing password confirm",this.formError.oFormEntity=o,!1):t.value.length<5?(this.formError.message="Password must be at least 5 characters long",this.formError.oFormEntity=t,!1):o.value===t.value||(this.formError.message="Passwords do not match",this.formError.oFormEntity=o,!1)}verifyLogin(){this.setFormError(),this.unsetErrors();let e=document.getElementById("login_email"),r=document.getElementById("login_password");return""===e.value?(this.formError.message="Login is blank",this.formError.oFormEntity=e,!1):e.value.length<5||-1===e.value.indexOf("@")?(this.formError.message="Not a valid email address",this.formError.oFormEntity=e,!1):""===r.value?(this.formError.message="Password cannot be left blank",this.formError.oFormEntity=r,!1):!(r.value.length<5)||(this.formError.message="Password must be at least 5 characters",this.formError.oFormEntity=r,!1)}errorHandler(){let e=this.formError.oFormEntity,r=document.createElement("div");r.style.width="200px",r.style.padding="5px",r.style.textAlign="right",r.style.color="red",e.parentNode.insertBefore(r,e.parentNode.childNodes[0]),r.innerHTML=this.formError.message,r.id="error-msg",e.classList.add("form-error")}unsetErrors(){let e=document.getElementById("error-msg");e&&e.parentNode.removeChild(e);let r=document.querySelector(".form-error");r&&r.classList.remove("form-error")}}